Pipeline for FINTA Flow
======================================

USAGE

nextflow run main.nf 
--input inputs/ \
--model model.pt \
--atlas_config config.json \
--atlas_anat anat.nii.gz \
--atlas_directory atlas/ \
--atlas_thresholds thresholds.json [OPTIONAL_ARGUMENTS]


DESCRIPTION

    --input=/path/to/[root]             Root folder containing multiple subjects. 
                                        You can pass many trk file per subjects (Local.trk, PFT.trk, SET.trk, ...)

                                        [root]
                                        ├── S1
                                        │   ├── *t1.nii.gz
                                        |   ├── *wm.nii.gz
                                        |   ├── *peaks.nii.gz
                                        |   ├── *fa.nii.gz
                                        │   └── *.trk
                                        └── S2
                                            └── *

    --model                             Path to .pt Pytorch model
    --atlas_config                      Path to json config file
    --atlas_anat                        Path to reference anatomy of the atlas
    --atlas_directory                   Path of the folder containing all 
    --atlas_thresholds                  Path to json thresholds file
    --number_rejection_sampling_config  Number of streamlines generated by the RS process.
                                        NOT THE FINAL NUMBER: They are filtered to match the dMRI underlying signal.

    --max_total_sampling_config         Maximum of sampled streamlines. In general, if number_rejection_sampling is smaller
                                        than 10%, we should stop.

    --ratio_atlas_bundle_config         Seed composition (subject bundle|atlas bundle) that the Parzen Window is based on.
                                        If too few streamlines are clustered the ratio might not be respected
                                        to match the number of Parzen Window seeds

    --degree_config                     GESTA acceptance maximum local orientation angle to the fODF peaks
    --white_matter_config               Bundle wise white matter mask to use




    OPTIONAL ARGUMENTS (current value)


    --batch_sampling                        Batch used for the RS ($batch_sampling).

    --parzen_window_seeds                   Number of seeds used for the Parzen Window ($parzen_window_seeds)

    --fa_threshold                          Threshold to use when the FA is considered as the WM mask ($fa_threshold)

    --device                                On which device pytorch inference is done ( cuda|cpu )
                                            Default: (cpu) -> Using: ($device)

    --run_gesta                             Run GESTA ($run_gesta).

    --registration_speed                    Registration speed 0 = antsRegsitrationSyN.sh, 1 = antsRegsitrationSyNQuick.sh
                                            Default: (1) -> Using: ($registration_speed)

    --register_processes                    Number of processes for registration task ($register_processes).

    --processes                             The number of parallel processes to launch ($cpu_count).
                                            Only affects the local scheduler.

    --output_dir                            Directory where to write the final results.
                                            By default, will be in "./results"

NOTES

Use '-C config_file.config' to specify a non-default configuration file.
The '-C config_file.config' must be inserted after the nextflow call
like 'nextflow -C config_file.config run ...'.
